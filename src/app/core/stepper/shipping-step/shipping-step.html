@if (isLoading()) {
  <div class="flex items-center justify-center py-20">
    <span class="loading loading-spinner loading-lg text-primary"></span>
  </div>
} @else {
  <div>
    <h2 class="text-xl md:text-2xl font-bold text-base-content mb-4 md:mb-6">{{ t('shippingTitle') }}</h2>

    <!-- Address Form: create first address or update existing one -->
    <div class="border-t pt-4 md:pt-6">
      <h3 class="text-base md:text-lg font-semibold text-base-content mb-3 md:mb-4">
        {{ selectedAddressId() ? t('editAddressTitle') : t('newAddressTitle') }}
      </h3>
        
        <form class="space-y-4" (ngSubmit)="saveAddress()">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">{{ t('fullName') }} *</span>
              </label>
              <input 
                type="text" 
                class="input input-bordered w-full" 
                placeholder="John Doe"
                [(ngModel)]="formData.fullName"
                name="fullName"
                required
              />
            </div>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">{{ t('phoneNumber') }} *</span>
              </label>
              <input 
                type="tel" 
                class="input input-bordered w-full" 
                placeholder="+966 5XX XXX XXXX"
                [(ngModel)]="formData.phoneNumber"
                name="phoneNumber"
                required
              />
            </div>
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">{{ t('addressLine1') }} *</span>
            </label>
            <input 
              type="text" 
              class="input input-bordered w-full" 
              placeholder="Street address, building number"
              [(ngModel)]="formData.addressLine1"
              name="addressLine1"
              required
            />
          </div>
          
          <div class="form-control">
            <label class="label">
              <span class="label-text font-medium">{{ t('addressLine2Optional') }}</span>
            </label>
            <input 
              type="text" 
              class="input input-bordered w-full" 
              placeholder="Apartment, suite, etc."
              [(ngModel)]="formData.addressLine2"
              name="addressLine2"
            />
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">{{ t('city') }} *</span>
              </label>
              <input 
                type="text" 
                class="input input-bordered w-full" 
                placeholder="City"
                [(ngModel)]="formData.city"
                name="city"
                required
              />
            </div>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">{{ t('state') }} *</span>
              </label>
              <input 
                type="text" 
                class="input input-bordered w-full" 
                placeholder="State"
                [(ngModel)]="formData.state"
                name="state"
                required
              />
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3 md:gap-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">{{ t('postalCode') }} *</span>
              </label>
              <input 
                type="text" 
                class="input input-bordered w-full" 
                placeholder="12345"
                [(ngModel)]="formData.postalCode"
                name="postalCode"
                required
              />
            </div>
            
            <div class="form-control">
              <label class="label">
                <span class="label-text font-medium">{{ t('country') }} *</span>
              </label>
              <input 
                type="text" 
                class="input input-bordered w-full" 
                placeholder="Saudi Arabia"
                [(ngModel)]="formData.country"
                name="country"
                required
              />
            </div>
          </div>
          
          <div class="form-control">
            <label class="label cursor-pointer justify-start gap-3">
              <input 
                type="checkbox" 
                class="checkbox accent-[#054239]" 
                [(ngModel)]="formData.isDefault"
                name="isDefault"
              />
              <span class="label-text">{{ t('setAsDefault') }}</span>
            </label>
          </div>
          
          <div class="flex gap-3 mt-4 md:mt-6">
            <button 
              type="submit" 
              class="btn border-none bg-[#054239] text-white hover:bg-[#04352f]"
              [disabled]="!isFormValid() || isSubmitting()"
            >
              @if (isSubmitting()) {
                <span class="loading loading-spinner loading-sm"></span>
                {{ t('saving') }}
              } @else {
                {{ selectedAddressId() ? t('updateAddressBtn') : t('saveAddressBtn') }}
              }
            </button>
          </div>
        </form>
    </div>
  </div>
}

