<div class="p-6">
  <div class="flex justify-between items-center mb-6">
    <div>
      <h1 class="text-3xl font-bold text-base-content">System Health</h1>
      <p class="text-base-content/70 mt-2">Overview of application health checks</p>
    </div>
    <div class="flex gap-2 items-center">
      <select class="select select-bordered" [ngModel]="minutes()" (ngModelChange)="onMinutesChange(+$event)">
        <option [value]="15">Last 15 min</option>
        <option [value]="60">Last 60 min</option>
        <option [value]="240">Last 4 hours</option>
        <option [value]="1440">Last 24 hours</option>
      </select>
      <button class="btn" (click)="load()" [disabled]="isLoading()">
        @if (isLoading()) { <span class="loading loading-spinner loading-sm"></span> } Reload
      </button>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="card bg-base-100 shadow-sm border border-base-300 lg:col-span-1">
      <div class="card-body p-4">
        <h2 class="card-title">Summary</h2>
        @if (isLoading()) {
          <div class="py-8 flex justify-center"><span class="loading loading-spinner loading-lg"></span></div>
        } @else {
          @if (summary$ | async; as summary) {
            <div class="mt-2">
              <div class="mb-2">
                <span class="badge" [class.badge-success]="summary.healthy" [class.badge-error]="!summary.healthy">
                  {{ summary.healthy ? 'Healthy' : 'Unhealthy' }}
                </span>
              </div>
              <div class="flex items-center gap-2">
                <span class="font-semibold">Database:</span>
                <span class="badge" [class.badge-success]="summary.checks.database" [class.badge-error]="!summary.checks.database">
                  {{ summary.checks.database ? 'OK' : 'Fail' }}
                </span>
              </div>
              <div class="text-sm text-base-content/60 mt-3">
                Updated: {{ summary.timestamp | date:'short' }}
              </div>
            </div>
          }
        }
      </div>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-300 lg:col-span-2">
      <div class="card-body p-4">
        <div class="flex items-center justify-between mb-4">
          <h2 class="card-title">Health Chart</h2>
        </div>
        @if (isLoading()) {
          <div class="py-12 flex justify-center"><span class="loading loading-spinner loading-lg"></span></div>
        } @else {
          @if (chartData().length === 0) {
            <div class="text-center text-base-content/60 py-8">No data available</div>
          } @else {
            <div class="h-80">
              <canvas baseChart
                  [data]="healthChartData"
                  [options]="healthChartOptions"
                  type="line">
              </canvas>
            </div>
            @if (chartData()[0]) {
              <div class="mt-3 text-xs text-base-content/60 text-center">
                From {{ chartData()[0].date | date:'shortTime' }} to {{ chartData()[chartData().length - 1].date | date:'shortTime' }}
              </div>
            }
          }
        }
      </div>
    </div>
  </div>
</div>
